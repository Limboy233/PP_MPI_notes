
点对点通信，它可以分为两种主要方式：阻塞式和非阻塞式。

# 点对点通讯(Blocking)
==在阻塞式通信中，程序会等待直到消息传递操作完成，然后才继续执行后续代码。==

**阻塞式通信确保发送和接收操作在消息完全传递后才返回，这可以简化程序的控制流，但有时也可能导致性能问题，特别是在大规模并行计算中**

## 局部与非局部
- MPI_Send：标准模式，用于向目标进程发送消息。
- MPI_Bsend：带缓冲区的模式，消息被缓冲然后发送。
- MPI_Ssend：同步模式，发送消息并等待接收者准备好接收。
- MPI_Rsend：准备就绪模式，不进行缓冲，直接发送。

1. **标准模式**：MPI库会自动决定是否使用特殊的系统缓冲区。如果使用系统缓冲区，消息发送操作会在数据传输到缓冲区后立即完成，而不受接收方是否已经开始接收消息的影响。这种情况下，标准模式的行为类似于缓冲模式。
    
2. **缓冲模式**：在使用缓冲模式时，发送方需要自行定义足够大的用户缓冲区（使用`MPI_Buffer_attach`函数）。消息发送操作会在数据传输到用户缓冲区后立即完成，而不受接收方是否已经开始接收消息的影响。因此，缓冲模式的消息发送是     **局部的。**
    
3. **同步模式**：在同步模式中，消息发送操作可能会在接收方开始接收消息之前开始，但只有在接收方开始接收消息后，发送操作才会完成。同步模式的消息发送是   **非局部的。**
    
4. **准备就绪模式**：在准备就绪模式中，消息发送操作只能在接收方已经准备好接收消息的情况下开始。如果接收方没有准备好接收，发送操作会被视为错误，结果不确定。准备就绪模式的消息发送是非局部的，通常较少使用。

==不同模式下的消息发送操作可能会表现为局部或非局部操作，也就是说，它们可能会受到其他进程的行为影响==

## 接收
`MPI_Recv`函数在成功接收消息并填充接收区 `buf` 后才会返回。参数 `source` 和 `msgtag` 可以使用特殊常量 `MPI_ANY_SOURCE` 和 `MPI_ANY_TAG`，分别表示消息可以来自任何进程或具有任何标签的消息。
==**这个buff 和上文的buffer 不同这个就是接收的区域地址,而不是另外一块缓冲区**==
## Status
MPI_Status 参数是一个结构体，它包含了有关接收到的消息的额外信息，包括消息来源、消息标签、错误代码等。还有一个额外的字段用于确定接收到的消息中的元素数量。要获取元素数量，可以使用`MPI_Get_count(MPI_Status* status, MPI_Datatype datatype, int* count)` 函数。

另外，如果您的程序不需要使用 `status` 参数提供的信息，可以使用 `MPI_STATUS_IGNORE` 常量来代替，该常量在MPI-2标准中引入

## MPI_Probe
您可能需要==在实际接收消息之前获取关于预期消息的附加信息==，例如确定足够大的缓冲区以容纳接收的消息。这时可以使用 `MPI_Probe` 函数，它允许您查询有关消息的信息，而不会实际接收消息。`MPI_Probe` 参数与 `MPI_Recv` 中的参数相同

## 缓冲
如果要在缓冲模式中发送消息，您需要使用 `MPI_Buffer_attach` 和 `MPI_Buffer_detach` 辅助函数。`MPI_Buffer_attach` 函数用于定义用于缓冲模式消息发送的缓冲区，而 `MPI_Buffer_detach` 用于释放先前定义的缓冲区。
1. `MPI_Buffer_attach` 函数允许定义一个缓冲区，该缓冲区用于后续的缓冲传输。缓冲区的大小由 `size` 参数以字节为单位指定，它应足够大以容纳要传输的消息以及额外的用于管理缓冲传输的服务信息。服务信息的大小由 MPI_BSEND_OVERHEAD 常量确定。一个进程在任何时刻只能使用一个缓冲区，所以一旦定义了缓冲区，在程序中不能再次访问它。
    
2. `MPI_Buffer_detach` 函数用于释放先前定义的缓冲区。它返回缓冲区的地址（`buf` 参数）和缓冲区的大小（`size` 参数），这两个参数都是输出参数

## 两个操作组合
此外，MPI还提供了 `MPI_Sendrecv` 和 `MPI_Sendrecv_replace` 函数，用于执行组合发送和接收操作，这两个函数将发送和接收结合在一起，允许一次性处理消息的发送和接收。
- `MPI_Sendrecv` 函数同时执行发送和接收操作，允许进程之间的相互通信。它需要多个参数，包括发送缓冲区 `sbuf`、发送元素数量 `scount`、发送数据类型 `stype`、目标进程的排名 `dest`、发送消息的标签 `stag`、接收缓冲区 `rbuf`（作为输出参数）、接收元素数量上限 `rcount`、接收数据类型 `rtype`、源进程的排名 `source`、接收消息的标签 `rtag`、通信器 `comm` 以及 `MPI_Status` 结构体参数 `status`（用于获取接收到的消息的信息）。
    
- `MPI_Sendrecv_replace` 函数也同时执行发送和接收操作，但使用一个共享的缓冲区，该缓冲区既用于发送又用于接收。它需要更少的参数，包括共享缓冲区 `buf`（作为输入和输出参数）、缓冲区大小 `count`、数据类型 `datatype`、目标进程排名 `dest`、发送消息标签 `stag`、源进程排名 `source`、接收消息标签 `rtag`、通信器 `comm` 以及 `MPI_Status` 结构体参数 `status`。